#!/bin/bash

## prepare the VMs for local testing of VS

cd `dirname "$0"`

function prepare_pfe {
    echo "== preparing VS pfe =="
    vbox-clone Wheezy 'VS pfe'
    vbox-mount 'VS pfe'
    sudo ./vbox-customize 'vs' 30
    vbox-umount
}

function prepare_mongodb {
    echo "== preparing VS MongoDB =="
    vbox-clone Wheezy 'VS MongoDB'
    vbox-mount 'VS MongoDB'
    sudo ./vbox-customize 'mongo.vs' 31
    vbox-umount
}

function prepare_playapp {
    echo "== preparing VS Play app =="
    vbox-clone Wheezy 'VS Play app'
    vbox-mount 'VS Play app'
    sudo ./vbox-customize 'play.vs' 32
    vbox-umount
}

function prepare_graphite {
    echo "== preparing VS Graphite =="
    vbox-clone Wheezy 'VS Graphite'
    vbox-mount 'VS Graphite'
    sudo ./vbox-customize 'graphite.vs' 33
    vbox-umount
}

if [ $# -eq 0 ]; then
    echo "You're about to create/override all the VMs for VS. Press [ctrl-c] to avoid that."
    read
    VMS="pfe mongodb playapp graphite"
else
    VMS=$@
fi

sudo echo

for i in $VMS; do
    case $i in
        pfe|proxy)
            prepare_pfe
            ;;
        mongodb|db|database)
            prepare_mongodb
            ;;
        playapp|play|webapp)
            prepare_playapp
            ;;
        graphite|monitoring)
            prepare_graphite
            ;;
    esac
done
