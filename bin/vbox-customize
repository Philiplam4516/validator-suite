#!/bin/bash

## customizes an existing VM

WHO=`whoami`

if [ "$WHO" != "root" ]; then
    echo "You must run this script as root"
    exit 1
fi

FQDN="$1"

# set the hostname
echo $FQDN > /mnt/etc/hostname

sed -i "s|wheezy|${FQDN}|g" /mnt/etc/hosts

# modify the user used for the FUSE mount
sed -i "s|betehess|${SUDO_USER}|g" /mnt/etc/fstab

NETWORK="$2"

INTERFACES=/mnt/etc/network/interfaces
if [ "$NETWORK" = "dhcp" ]; then
    echo "configuring $FQDN using DHCP"
    cat > $INTERFACES <<EOF
# The loopback network interface
auto lo
iface lo inet loopback
# The primary network interface
allow-hotplug eth0
iface eth0 inet dhcp
allow-hotplug eth1
iface eth1 inet dhcp
EOF
else
    echo "configuring $FQDN using static IP address $NETWORK"
    cat > $INTERFACES <<EOF
# The loopback network interface
auto lo
iface lo inet loopback
# The primary network interface
allow-hotplug eth0
iface eth0 inet dhcp
allow-hotplug eth1
iface eth1 inet static
address 192.168.56.$NETWORK
netmask 255.255.255.0
gateway 192.168.56.0
dns-search w3.org
EOF
fi
