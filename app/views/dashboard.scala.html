@(jobs: Iterable[(Job, JobData)] = None)()(implicit flash: Flash, userOpt: Option[User])

@import views.Helper._
@import org.w3.vs.run._

@libs.main("Validator Suite", 
	stylesheets = List("dashboard.css"), 
	scripts = List("dashboard.js"),
	exec = """$(function(){window.Dashboard = new DashboardView();});""") {
	
	@libs.header(userOpt)
	
	<nav id="nav">
		<ul>
			<li><a href="@routes.Dashboard.dashboard">Dashboard</a></li>
			<li><a href="@routes.Dashboard.editJob(None)">Add new job</a></li>
		</ul>
	</nav>
	
	<section id="main">
	<div>
		@libs.navigation()
		
		@flash.data.map { case (key, message) =>
			<div class="@key vsmessage">@message</div>
		}
		
		<section id="jobs">
		<div>
		@for((job, data) <- jobs) {
			<article class="job" data-id="@job.id">
				<ul>
					<li>Name: <span class="name">@job.name</span></li>
					<li>Uri: <span class="uri">@job.strategy.seedURLs.head</span></li>
					<li>Distance: <span class="distance">@job.strategy.distance</span></li>
					<li>Status: <span class="status">@data.state</span></li>
					<li>Resources: <span class="resources">@data.resources</span></li>
				</ul>
				<ul>
					<li>Last run: <time datetime="">-</time></li>
					<li>Last updated: <time datetime="">-</time></li>
					<li>Valid: <span class="oks">@data.oks</span></li>
					<li>Errors: <span class="errors">@data.errors</span></li>
					<li>Warnings: <span class="warnings">@data.warnings</span></li>
				</ul>
				<form action="@routes.Dashboard.jobDispatcher(job.id)" method="post">
				<ul>
					<li><button type="submit" class="show" formmethod="get">Show</button></li>
					<li>@defining(data.state) { state =>
					  @state match {
					    case a @ (Busy | Waiting) => {<button type="submit" name="action" value="stop" class="stop">Stop</button>}
					    case _ => {<button type="submit" name="action" value="run" class="run">Run</button>}
					  }
					}</li>
					<li><button type="submit" name="action" value="runnow" class="nunnow">Run now</button></li>
					<li><button type="submit" class="edit" formmethod="get" formaction="@routes.Dashboard.editJob(Some(job.id))">Edit</button></li>
					<li><button type="submit" name="action" value="delete" class="delete">Delete</button></li>
				</ul>
				</form>
			</article>
		}
		</div>
		</section>
	</div>
	</section>
	
	<script type="text/template" id="job-template">
		<ul>
			<li>Name: <span class="name"><%= name %></span></li>
			<li>Uri: <span class="uri"><%= seedUri %></span></li>
			<li>Distance: <span class="distance"><%= distance %></span></li>
			<li>Status: <span class="status"><%= data.get('status') %></span></li>
			<li>Resources: <span class="resources"><%= data.get('resources') %></span></li>
		</ul>
		<ul>
			<li>Last run: <time datetime="">-</time></li>
			<li>Last updated: <time datetime="">-</time></li>
			<li>Valid: <span class="oks"><%= data.get('oks') %></span></li>
			<li>Errors: <span class="errors"><%= data.get('errors') %></span></li>
			<li>Warnings: <span class="warnings"><%= data.get('warnings') %></span></li>
		</ul>
		<ul>
			<li><a href="/job/<%= id %>" class="show">Show</a></li>
			<% if (data.get("status") == "Running" || data.get("status") == "Idle") { %>
			<li><a href="/job/<%= id %>" class="stop">Stop</a></li>
			<% } else { %>
			<li><a href="/job/<%= id %>" class="run">Run</a></li>
			<% } %>
			<li><a href="/job/<%= id %>" class="runnow">Run now</a></li>
			<li><a href="/job/<%= id %>/edit" class="edit">Edit</a></li>
			<li><a href="/job/<%= id %>" class="delete">Delete</a></li>
		</ul>
	</script>
	
	@libs.footer()
	
}
