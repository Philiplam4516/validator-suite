package org.w3.vs.model

import org.w3.util._

import java.util.UUID
import org.joda.time._
import scala.io.Source
import com.codecommit.antixml._

/** A [[org.w3.vs.model.SiteMap]]-based [[org.w3.vs.model.ActionStrategy]]
  * 
  * @param uuid
  * @param name
  * @param delay
  * @param sitemap
  */
case class SiteMapBasedStrategy(
    uuid: UUID,
    name: String,
    delay: Long,
    maxNumberOfResources: Int,
    sitemap: SiteMap)
extends Strategy {
  
  val seedURLs: Iterable[URL] = sitemap.urls map { _.loc }
  
  def mainAuthority: Authority = this.seedURLs.headOption map {_.authority} getOrElse sys.error("No seed url in strategy")

  val authorityToObserve: Authority =
    sitemap.urls.head.loc.authority
    
  def shouldObserve(url: URL): Boolean =
    authorityToObserve == url.authority
  
  def fetch(url: URL, distance: Int): HttpAction =
    if (sitemap.urls exists { _.loc == url })
      GET
    else
      HEAD
  
  val assertorsFor = AssertorSelector.simple

}
